/*! proso-apps-js - v1.0.0 - 2015-09-24 */


function obj2get(a,b,c){var d="";for(var e in a)a.hasOwnProperty(e)&&(""!==d&&(d+="&"),-1===c.indexOf(e)&&(d+=b),d+=e+"="+encodeURIComponent(a[e]));return d}angular.module("proso.apps",["proso.apps.tpls","proso.apps.common-config","proso.apps.common-logging","proso.apps.common-toolbar","proso.apps.feedback-comment","proso.apps.feedback-rating","proso.apps.flashcards-practice","proso.apps.flashcards-userStats","proso.apps.user-user","proso.apps.user-login"]),angular.module("proso.apps.tpls",["templates/common-toolbar/toolbar.html","templates/feedback-comment/comment.html","templates/feedback-rating/rating.html","templates/user-login/login-modal.html","templates/user-login/signup-modal.html"]),angular.module("proso.apps.gettext",[]).value("gettext",window.gettext||function(a){return a}).filter("trans",["gettext",function(a){return function(b){return a(b)}}]),angular.module("gettext").run(["gettextCatalog",function(a){a.setStrings("cs",{Appropriate:"Tak akorát",Close:"Zavřít","Did you find a bug in the app? Do you have an improvement idea? Or any other comment? We are eager to hear anything you'd like to tell us.":"Narazili jste na chybu v aplikaci? Máte nápad na vylepšení? Nebo jakýkoliv jiný postřeh či komentář? Zajímá nás všechno, co nám chcete sdělit.","Don't know / Don't want to rate":"Nevím / Nechci hodnotit","E-mail":"E-mail","How difficult are the questions?":"Jak těžké se vám zdají otázky?",Password:"Heslo","Password again":"Heslo znovu","Registration was successful. You can continue to use the application.":"Registrace proběhla úspěšně. Můžete pokračovat v používání aplikace.",Send:"Odeslat","Sign In":"Přihlásit se","Sign Up":"Zaregistrovat se","Something wrong has happened.":"V aplikaci nastala chyba.","Thank you for the message. User feedback is very important for us.":"Děkujeme Vám za zaslané informace. Feedback od uživatelů je k nezaplacení.","Thank you for your rating.":"Děkujeme za vaše hodnocení.","Too difficult":"Příliš těžké","Too easy":"Příliš lehké",Username:"Uživatelské jméno","Write to us":"Napište nám","Your e-mail address (optional)":"Váš e-mail (nepovinné)","and get all the benefits of registered users.":"a získejte všechny výhody registrovaných uživatelů.","via E-mail":"přes E-mail","via Facebook":"přes Facebook","via Google":"přes Google"}),a.setStrings("en",{"Did you find a bug in the app? Do you have an improvement idea? Or any other comment? We are eager to hear anything you'd like to tell us.":"Did you find a bug in the app? Do you have an improvement idea? Or any other comment? We are eager to hear anything you'd like to tell us.","Don't know / Don't want to rate":"Don't know / Don't want to rate","E-mail":"E-mail","How difficult are the questions?":"How difficult are the questions?",Password:"Password","Password again":"Password again","Registration was successful. You can continue to use the application.":"Registration was successful. You can continue to use the application.",Send:"Send","Sign In":"Sign In","Sign Up":"Sign Up","Something wrong has happened.":"Something wrong has happened.","Thank you for the message. User feedback is very important for us.":"Thank you for the message. User feedback is very important for us.","Thank you for your rating.":"Thank you for your rating.","Too difficult":"Too difficult","Too easy":"Too easy",Username:"Username","Write to us":"Write to us","Your e-mail address (optional)":"Your e-mail address (optional)","and get all the benefits of registered users.":"and get all the benefits of registered users.","via E-mail":"via E-mail","via Facebook":"via Facebook","via Google":"via Google"}),a.setStrings("es",{Appropriate:"Adecuado",Close:"Cerrar","Did you find a bug in the app? Do you have an improvement idea? Or any other comment? We are eager to hear anything you'd like to tell us.":"¿Encontraste algún error en el programa? ¿Tienes alguna sugerencia sobre como podemos mejorar? ¿Quieres compartir tu opinión con nosotros? Nos gustaría escuchar lo que tengas que decir.","Don't know / Don't want to rate":"No sé/No quiero calificar","E-mail":"E-mail","How difficult are the questions?":"¿Qué tan difíciles son estas preguntas?",Password:"Contraseña","Password again":"Contraseña de nuevo","Registration was successful. You can continue to use the application.":"Registro exitoso. Puedes continuar usando la aplicación.",Send:"Enviar","Sign In":"Iniciar sesión","Sign Up":"Registrarse","Something wrong has happened.":"Algo malo ha ocurrido.","Thank you for the message. User feedback is very important for us.":"Gracias por tu mensaje. Tu opinión es muy importante para nosotros.","Thank you for your rating.":"Gracias por calificarnos.","Too difficult":"Muy dificil","Too easy":"Muy facil",Username:"Nombre de usuario","Write to us":"Sugerencias","Your e-mail address (optional)":"Tu e-mail (opcional)","and get all the benefits of registered users.":"y accede a todos los benecifios de un usuario registrado.","via E-mail":"con E-mail","via Facebook":"con Facebook","via Google":"con Google"})}]);var configServiceLoaded;if(configServiceLoaded)throw"ConfigService already loaded";configServiceLoaded=!0;var m=angular.module("proso.apps.common-config",["ngCookies"]);m.factory("configService",["$http","$window","$cookieStore",function(a,b,c){if(b.configService)return b.configService;var d=this,e=null;d.getConfig=function(a,b,c){var g=null;if("undefined"!=typeof f[a+"."+b])return g=f[a+"."+b],d.isDebug()&&console.log(a+"."+b,"overridden",g),g;if(null===e)return void console.error("Config not loaded");g=e[a];for(var h=b.split("."),i=0;i<h.length;i++){if("undefined"==typeof g)return d.isDebug()&&console.log(a+"."+b,"use default",c),c;g=g[h[i]]}return"undefined"==typeof g?(d.isDebug()&&console.log(a+"."+b,"use default",c),c):(d.isDebug()&&console.log(a+"."+b,"from config",g),g)},d.isDebug=function(){return f.debug===!0},d.loadConfig=function(){return a.get("/common/config/").success(function(a){d.processConfig(a.data)}).error(function(){console.error("Problem while loading config from server")})},d.processConfig=function(a){e=angular.copy(a)},d.override=function(a,b){"true"===b?b=!0:"false"===b?b=!1:$.isNumeric(b)&&(b=parseFloat(b)),f[a]=b,c.put("configService:overridden",f)},d.removeOverridden=function(a){delete f[a],c.put("configService:overridden",f)},d.resetOverridden=function(){f={},c.put("configService:overridden",f)},d.getOverridden=function(){return angular.copy(f)};var f=c.get("configService:overridden")||{};return b.configService=d,d}]),m.config(["$httpProvider",function(a){var b;a.interceptors.push(function(a){return{request:function(c){if(!a.has("configService"))return console.log("There is no configuration service available."),c;if(b=b||a.get("configService"),null!==c.url.split("?")[0].match(/\.\w+$/))return c;var d=obj2get(b.getOverridden(),"config.",["user","time","debug"]);return""===d?c:(c.url+=-1===c.url.indexOf("?")?"?":"&",c.url+=d,c)}}})}]);var loggingServiceLoaded;if(loggingServiceLoaded)throw"LoggingService already loaded";loggingServiceLoaded=!0;var m=angular.module("proso.apps.common-logging",[]);m.factory("loggingService",["$window",function(a){if(a.loggingService)return a.loggingService;var b=this,c=[],d=[];return b.getDebugLog=function(){return c},b.extendDebugLog=function(a,b){b.forEach(function(b){b.url=a,c.push(b)}),d.forEach(function(a){a(b)})},b.addDebugLogListener=function(a){d.push(a)},a.loggingService=b,b}]),m.config(["$httpProvider",function(a){var b;a.interceptors.push(function(a){return{response:function(c){return b=b||a.get("loggingService"),c.data instanceof Object&&"debug_log"in c.data&&b.extendDebugLog(c.config.url,c.data.debug_log),c}}})}]);var m=angular.module("proso.apps.common-toolbar",["ngCookies","proso.apps.common-config"]);m.controller("ToolbarController",["$scope","$cookies","configService","loggingService","$timeout","$http",function(a,b,c,d,e,f){a.override=c.override,a.removeOverridden=c.removeOverridden,a.date=new Date,a.debugLog=[],a.opened="true"===b["toolbar:opened"],a.maximized="true"===b["toolbar:maximized"],a.loggingOpened=!0,a.abTestingOpened=!1,a.flashcardsLimit=10,a.override("debug",!0),a.overridden=c.getOverridden(),d.addDebugLogListener(function(b){e(function(){b.forEach(function(b){a.debugLog.unshift(b)})})}),a.$watch("opened",function(a,c){b["toolbar:opened"]=a}),a.$watch("maximized",function(a,c){b["toolbar:maximized"]=a}),a.addToOverride=function(a){a&&c.override(a,"")},a.getOverridden=function(){var a=c.getOverridden();return Object.keys(a).filter(function(a){return"user"===a||"debug"===a||"time"===a}).forEach(function(b){delete a[b]}),a},a.openABTesting=function(){a.abTestingOpened=!a.abTestingOpened,a.abTestingOpened&&!a.abExperiment&&f.get("/configab/experiments",{params:{filter_column:"is_enabled",filter_value:!0,stats:!0,learning_curve_length:5}}).success(function(b){var c=b.data;0!==c.length&&(a.abExperiment=c[0],a.abExperiment.setups.forEach(function(b){b.values.forEach(function(b){a.abExperiment.variables.forEach(function(a){(a.id=b.variable_id)&&(b.variable=a)})})}),a.drawABTestingBar())}),a.drawABTestingBar()},a.showFlashcardsPractice=function(){a.flashcardsAnswers=[];var b={limit:a.flashcardsLimit};a.flashcardsCategories&&(b.categories=JSON.stringify(a.flashcardsCategories.split(",").map(function(a){return a.trim()}))),a.flashcardsContexts&&(b.contexts=JSON.stringify(a.flashcardsContexts.split(",").map(function(a){return a.trim()}))),a.flashcardsTypes&&(b.types=JSON.stringify(a.flashcardsTypes.split(",").map(function(a){return a.trim()}))),f.get("/flashcards/practice_image",{params:b}).success(function(a){document.getElementById("flashcardsChart").innerHTML=a})},a.showFlashcardsAnswers=function(){document.getElementById("flashcardsChart").innerHTML="",f.get("/flashcards/answers",{params:{limit:a.flashcardsLimit}}).success(function(b){a.flashcardsAnswers=b.data})},a.drawABTestingBar=function(b){if(a.abExperiment){var c=new google.visualization.DataTable;c.addColumn("string","Experiment Setup"),c.addColumn("number","Number of Answers"),c.addColumn({type:"number",role:"interval"}),c.addColumn({type:"number",role:"interval"}),c.addColumn("number","Number of Users"),c.addColumn("number","Returning Chance"),c.addColumn({type:"number",role:"interval"}),c.addColumn({type:"number",role:"interval"}),c.addRows(a.abExperiment.setups.map(function(a){return["Setup #"+a.id,a.stats.number_of_answers.value,a.stats.number_of_answers.confidence_interval.min,a.stats.number_of_answers.confidence_interval.max,a.stats.number_of_users,a.stats.returning_chance.value,a.stats.returning_chance.confidence_interval.min,a.stats.returning_chance.confidence_interval.max]}));var d=c,e="All";if(b){var f={number_of_answers:[0,1,2,3],number_of_users:[0,4],returning_chance:[0,5,6,7]};e=b,d=new google.visualization.DataView(c),d.setColumns(f[b])}var g=new google.visualization.ColumnChart(document.getElementById("abChart")),h={title:e,legend:{position:"none"},vAxis:{format:"#.###"},width:480,height:300,intervals:{styel:"bars",pointSize:10,barWidth:0,lineWidth:4},chartArea:{width:"80%",height:"80%"}};g.draw(d,h)}},a.drawABTestingLearning=function(b){if(a.abExperiment){var c="learning_curve";b&&(c="learning_curve_all_users");var d=new google.visualization.DataTable;d.addColumn({type:"number",role:"domain"});var e=0;a.abExperiment.setups.forEach(function(a){d.addColumn("number","Setup #"+a.id),d.addColumn({type:"number",role:"interval"}),d.addColumn({type:"number",role:"interval"}),e=Math.max(a.stats[c].success.length)});for(var f=[],g=0;e>g;g++){var h=[g];a.abExperiment.setups.forEach(function(a){h.push(a.stats[c].success[g].value),h.push(a.stats[c].success[g].confidence_interval.min),h.push(a.stats[c].success[g].confidence_interval.max)}),f.push(h)}d.addRows(f);var i=new google.visualization.LineChart(document.getElementById("abChart")),j={title:"Learning",legend:{position:"none"},vAxis:{format:"#.###"},hAxis:{title:"Attempt",position:"center"},intervals:{style:"area",fillOpacity:.2},lineWidth:4,pointSize:10,curveType:"function",width:480,height:300,chartArea:{width:"80%",height:"80%"}};i.draw(d,j)}},a.showAuditChart=function(){var b={};a.auditLimit&&(b.limit=a.auditLimit),a.auditUser&&(b.user=a.auditUser),a.auditPrimary&&(b.item=a.auditPrimary),a.auditSecondary&&(b.item_secondary=a.auditSecondary),f.get("/models/audit/"+a.auditKey,{params:b}).success(function(b){var c=new google.visualization.DataTable;c.addColumn("number","Update"),c.addColumn("number","Value"),c.addColumn({type:"datetime",role:"tooltip"}),b.data.reverse();for(var d=[],e=0;e<b.data.length;e++){var f=b.data[e];d.push([e,f.value,new Date(f.time)])}c.addRows(d);var g={title:a.auditKey,legend:{position:"none"},vAxis:{format:"#.###"},hAxis:{title:"Update",position:"center"},width:480,height:300,chartArea:{width:"80%",height:"80%"}},h=new google.visualization.NumberFormat({fractionDigits:3,pattern:"#.###"});h.format(c,1);var i=new google.visualization.LineChart(document.getElementById("auditChart"));i.draw(c,g)})},a.recommendUser=function(){var b={};a.recommendationRegisterMin&&(b.register_min=a.recommendationRegisterMin),a.recommendationRegisterMax&&(b.register_max=a.recommendationRegisterMax),a.recommendationAnswersMin&&(b.number_of_answers_min=a.recommendationAnswersMin),a.recommendationAnswersMax&&(b.number_of_answers_max=a.recommendationAnswersMax),a.recommendationSuccessMin&&(b.success_min=a.recommendationSuccessMin),a.recommendationSuccessMax&&(b.success_max=a.recommendationSuccessMax),a.recommendationVariableName&&(b.variable_name=a.recommendationVariableName),a.recommendationVariableMin&&(b.variable_min=a.recommendationVariableMin),a.recommendationVariableMax&&(b.variable_max=a.recommendationVariableMax),a.recommendationOutput="Loading...",f.get("/models/recommend_users",{params:b}).success(function(b){b.data.length>0?a.recommendationOutput=b.data[0]:a.recommendationOutput="Not Found"})}}]),m.directive("toolbar",[function(){return{restrict:"E",controller:"ToolbarController",templateUrl:"templates/common-toolbar/toolbar.html"}}]);var m=angular.module("proso.apps.feedback-comment",["ui.bootstrap","gettext"]);m.directive("feedbackComment",["$modal","$window","gettextCatalog",function(a,b,c){return{restrict:"A",link:function(b,c,d){b.feedback={email:"@",text:""},b.openFeedback=function(){d.email&&(b.feedback.email=d.email),d.text&&(b.feedback.text=d.text),a.open({templateUrl:"templates/feedback-comment/comment.html",controller:e,size:"lg",resolve:{feedback:function(){return b.feedback}}})};var e=["$scope","$modalInstance","$http","$cookies","$location","feedback","gettextCatalog",function(a,b,c,d,e,f,g){a.feedback=f,a.alerts=[],a.send=function(){f.page=e.absUrl(),c.defaults.headers.post["X-CSRFToken"]=d.csrftoken,c.post("/feedback/feedback/",f).success(function(b){a.alerts.push({type:"success",msg:g.getString("Thank you for the message. User feedback is very important for us.")}),a.sending=!1,f.text=""}).error(function(){a.alerts.push({type:"danger",msg:g.getString("Something wrong has happened.")}),a.sending=!1}),a.sending=!0},a.closeAlert=function(b){a.alerts.splice(b,1)},a.cancel=function(){b.dismiss("cancel")}}];c.bind("click",b.openFeedback)}}}]);var m=angular.module("proso.apps.feedback-rating",["ui.bootstrap","gettext"]);m.controller("RatingModalController",["$scope","$rootScope","$modal",function(a,b,c){a.open=function(){a.email&&(a.feedback.email=a.email),c.open({templateUrl:"templates/feedback-rating/rating.html",controller:"RatingModalInstanceController",size:"lg",resolve:{feedback:function(){return a.feedback}}})},b.$on("openRatingModal",function(b,c){a.open()})}]),m.controller("RatingModalInstanceController",["$scope","$modalInstance","$http","$cookies","gettextCatalog",function(a,b,c,d,e){a.alerts=[],a.vote=function(b){a.answer=b,c.defaults.headers.post["X-CSRFToken"]=d.csrftoken,c.post("/feedback/rating/",{value:b}).success(function(b){a.alerts.push({type:"success",msg:e.getString("Thank you for your rating.")}),a.sending=!1}).error(function(){a.alerts.push({type:"danger",msg:e.getString("Something wrong has happened.")}),a.sending=!1}),a.sending=!0},a.closeAlert=function(c){a.alerts.splice(c,1),b.dismiss("cancel")},a.cancel=function(){b.dismiss("cancel")}}]),m.directive("ratingModal",["$window",function(a){return{restrict:"E",controller:"RatingModalController"}}]);var m=angular.module("proso.apps.flashcards-practice",["ngCookies","proso.apps.common-config"]);m.service("practiceService",["$http","$q","configService","$cookies",function(a,b,c,d){var e=this,f=[],g=null,h=!1,i=null,j=[],k={},l=0,m=0,n={},o={};e.initSet=function(a){e.flushAnswerQueue();var b="practice."+a+".";k.set_length=c.getConfig("proso_flashcards",b+"set_length",10),k.fc_queue_size_max=c.getConfig("proso_flashcards",b+"fc_queue_size_max",1),k.fc_queue_size_min=c.getConfig("proso_flashcards",b+"fc_queue_size_min",1),k.save_answer_immediately=c.getConfig("proso_flashcards",b+"save_answer_immediately",!1),k.cache_context=c.getConfig("proso_flashcards",b+"cache_context",!1),e.setFilter({}),l=0,i=null,e.clearQueue(),g=null,m++,n={flashcards:[],answers:[],correct:0,count:0}},e.setFilter=function(a){k.filter={contexts:[],categories:[],types:[]},angular.extend(k.filter,a)},e.getCurrent=function(){return l},e.getConfig=function(){return angular.copy(k)},e.saveAnswer=function(b,c){b&&(b.time=Date.now(),j.push(b),n.answers.push(b),n.count++,b.flashcard_id===b.flashcard_answered_id&&n.correct++),(k.save_answer_immediately||c||l>=k.set_length)&&j.length>0&&(j.forEach(function(a){a.time_gap=Math.round((Date.now()-a.time)/1e3),delete a.time}),a.defaults.headers.post["X-CSRFToken"]=d.csrftoken,a.post("/flashcards/answer/",{answers:j},{params:s(["avoid","limit"])}).error(function(a){console.error("Problem while uploading answer",a)}),j=[])},e.flushAnswerQueue=function(){e.saveAnswer(null,!0)},e.saveAnswerToCurrentFC=function(a,b,c){if(!i)return void console.error("There is no current flashcard");var d={flashcard_id:i.id,flashcard_answered_id:a,response_time:b,direction:i.direction};c&&(d.meta={client_meta:c}),i.practice_meta&&(d.meta?d.meta=angular.extend(d.meta,i.practice_meta):d.meta=i.practice_meta),i.options&&(d.option_ids=[],i.options.forEach(function(a){a.id!==i.id&&d.option_ids.push(a.id)})),e.saveAnswer(d)},e.getFlashcard=function(){return g?b(function(a,b){b("Already one flashcard promised")}):(g=b.defer(),h=!1,r(),g.promise.then(function(){g=null},function(){g=null}),g.promise)},e.clearQueue=function(){f=[]},e.preloadFlashcards=function(){p()},e.getFCQueue=function(){return f},e.getAnswerQueue=function(){return j},e.getSummary=function(){for(var a=angular.copy(n),b=0;b<Math.min(a.flashcards.length,a.answers.length);b++){var c=a.answers[b],d=a.flashcards[b];d.id===c.flashcard_id&&(d.answer=c),c.correct=c.flashcard_id===c.flashcard_answered_id}return a};var p=function(){if(!(f.length>=k.fc_queue_size_min)&&(k.filter.limit=k.fc_queue_size_max-f.length,g&&!h&&k.filter.limit++,k.filter.limit=Math.min(k.filter.limit,k.set_length-l-f.length),0!==k.filter.limit)){k.filter.avoid=i?[i.id]:[],f.forEach(function(a){k.filter.avoid.push(a.id)});var b,c=s();0===j.length?b=a.get("/flashcards/practice/",{params:c}):(a.defaults.headers.post["X-CSRFToken"]=d.csrftoken,b=a.post("/flashcards/practice/",{answers:j},{params:c}),j=[]);var e=m;b.success(function(a){e===m&&(f=f.concat(a.data.flashcards),q(),f.length>0?r():console.error("No Flashcards to practice"))}).error(function(a){null!==g&&g.reject("Something went wrong while loading flashcards from backend."),console.error("Something went wrong while loading flashcards from backend.")})}},q=function(){k.cache_context&&f.forEach(function(b){b.context_id in o?"loading"!==o[b.context_id]&&(b.context=o[b.context_id]):(o[b.context_id]="loading",a.get("/flashcards/context/"+b.context_id).success(function(a){o[b.context_id]=a.data,r()}).error(function(){delete o[b.context_id],console.error("Error while loading context from backend")}))})},r=function(){if(null!==g){if(k.set_length===l)return void g.reject("Set was completed");if(f.length>0){if(k.cache_context){if("object"!=typeof o[f[0].context_id])return;f[0].context=o[f[0].context_id]}i=f.shift(),l++,h=!0,n.flashcards.push(i),g.resolve(i)}p()}},s=function(a){a||(a=[]);var b={};for(var c in k.filter)-1===a.indexOf(c)&&(k.filter[c]instanceof Array?b[c]=JSON.stringify(k.filter[c]):b[c]=k.filter[c]);return k.cache_context&&(b.without_contexts=1),b}}]);var m=angular.module("proso.apps.flashcards-userStats",["ngCookies"]);m.service("userStatsService",["$http","$cookies",function(a,b){var c=this,d={};c.addGroup=function(a,b){b.language||delete b.language,d[a]=b},c.addGroupParams=function(a,b,c,e,f){d[a]={categories:b,contexts:c,types:e},"undefined"!=typeof f&&(d[a].language=f)},c.getStats=function(c,e){a.defaults.headers.post["X-CSRFToken"]=b.csrftoken;var f={filters:JSON.stringify(d)};return c&&(f.mastered=!0),e&&(f.username=e),a.get("/flashcards/user_stats/",{params:f})},c.getStatsPost=function(c,e){a.defaults.headers.post["X-CSRFToken"]=b.csrftoken;var f="?";return f+=c?"&mastered=true":"",f+=e?"&username="+e:"",a.post("/flashcards/user_stats/"+f,d)},c.clean=function(){d={}},c.getGroups=function(){return angular.copy(d)}}]);var m=angular.module("proso.apps.user-user",["ngCookies"]);m.service("userService",["$http",function(a){var b=this;b.status={logged:!1,loading:!1},b.user={};var c=this.update={},d=!1;b.error={},b.init=function(){},b.signup=function(c){b.status.loading=!0,f();var d=a.post("/user/signup/",c);return d.success(function(a){e(a.data)}).error(function(a){b.error=a})["finally"](function(a){b.status.loading=!1}),d},b.signupParams=function(a,c,d,e,f,g){return b.signup({username:a,email:c,password:d,password_check:e,first_name:f,last_name:g})},b.getUserProfile=function(b,c){var d={username:b};return c&&(d.stats=!0),a.get("/user/profile/",{params:d})},b.loadUser=function(c){b.status.loading=!0;var d={};return c&&(d.stats=!0),a.get("/user/profile/",{params:d}).success(function(a){e(a.data)})["finally"](function(a){b.status.loading=!1})},b.processUser=function(a){e(angular.copy(a))};var e=function(a){return a?(b.status.logged=a.user&&void 0!==a.user.email,b.user.profile=a,angular.extend(b.user,a.user),angular.extend(c,{user:{first_name:b.user.first_name,last_name:b.user.last_name},send_emails:b.user.profile.send_emails,"public":b.user.profile["public"]}),delete b.user.profile.user,void(d||(b.updateSession(),d=!0))):void(b.status.logged=!1)};b.login=function(c,d){b.status.loading=!0,f();var g=a.post("/user/login/",{username:c,password:d});return g.success(function(a){e(a.data)}).error(function(a){b.error=a})["finally"](function(a){b.status.loading=!1}),g},b.logout=function(){b.status.loading=!0,a.get("/user/logout/").success(function(a){g(b.user),b.status.logged=!1})["finally"](function(a){b.status.loading=!1})};var f=function(){g(b.error)},g=function(a){for(var b in a)a.hasOwnProperty(b)&&delete a[b]};b.loadUserFromJS=function(a,c){a.$apply(b.loadUser(c))},b.loadSession=function(){b.status.loading=!0,a.get("/user/session/").success(function(a){b.user.session=a.data})["finally"](function(a){b.status.loading=!1})},b.updateSession=function(){var b={locale:window.navigator.language||window.navigator.userLanguage||window.navigator.browserLanguage,display_height:window.innerHeight,display_width:window.innerWidth};try{b.time_zone=jstz.determine().name()}catch(c){console.log("JSTimeZone lib not loaded")}a.post("/user/session/",b).error(function(){console.error("Error while updating session")})},b.updateProfile=function(c){var d={user:{}};c.profile&&angular.extend(d,c.profile),angular.extend(d.user,c),delete d.user.profile,delete d.user.username,b.status.loading=!0,f();var g=a.post("/user/profile/",d);return g.success(function(a){e(a.data)}).error(function(a){b.error=a})["finally"](function(a){b.status.loading=!1}),g},b.loginGoogle=function(){h("/login/google-oauth2/","/user/close_popup/")},b.loginFacebook=function(){h("/login/facebook/","/user/close_popup/")};var h=function(a,b){var c="height=700,width=700,left=100,top=100,resizable=yes,scrollbars=yes,toolbar=no,menubar=no,location=yes,directories=no,status=yes";a+="?next="+b,window.open(a,"popup",c)};b.init()}]);var m=angular.module("proso.apps.user-login",["ui.bootstrap","gettext","proso.apps.user-user","angulartics","angulartics.google.analytics"]);m.controller("LoginController",["$scope","$modalInstance","signupModal","userService","gettextCatalog","$analytics",function(a,b,c,d,e,f){a.credentials={},a.alerts=[],a.cancel=function(){b.dismiss("cancel")},a.loginGoogle=function(){f.eventTrack("click",{category:"login",label:"/login/google"}),d.loginGoogle()},a.loginFacebook=function(){f.eventTrack("click",{category:"login",label:"/login/facebook"}),d.loginFacebook()},a.loginEmail=function(){f.eventTrack("click",{category:"login",label:"/login/email"}),d.login(a.credentials.username,a.credentials.password).error(a.onError).success(function(){a.cancel()})},a.openSignupModal=function(){a.cancel(),c.open()},a.signup=function(){f.eventTrack("click",{category:"signup",label:"/signup/email"}),d.signupParams(a.credentials.username,a.credentials.email,a.credentials.password,a.credentials.password_check,a.credentials.first_name,a.credentials.last_name).error(a.onError).success(function(){b.close()})},a.onError=function(b){f.eventTrack("error",{category:"login",label:"error/login"}),a.alerts.push({type:b.type||"danger",msg:b.error||e.getString("Something wrong has happened.")})},a.closeAlert=function(b){a.alerts.splice(b,1)}}]),m.factory("signupModal",["$modal",function(a){return{open:function(){a.open({templateUrl:"templates/user-login/signup-modal.html",controller:"LoginController"})}}}]),m.factory("loginModal",["$modal",function(a){return{open:function(){a.open({templateUrl:"templates/user-login/login-modal.html",controller:"LoginController"})}}}]),m.directive("loginButton",["loginModal",function(a){return{restrict:"A",link:function(b,c){c.bind("click",function(){a.open()})}}}]),angular.module("templates/common-toolbar/toolbar.html",[]).run(["$templateCache",function(a){a.put("templates/common-toolbar/toolbar.html",'<div id="proso-toolbar">\n    <div id="config-bar-show-button" ng-click="opened = !opened" ng-hide="opened"> proso bar </div>\n\n    <div id="config-bar" ng-cloak ng-show="opened" ng-class="{\'maximized\' : maximized}">\n        <div id="config-bar-header">\n            <span id="config-bar-maximize" ng-click="maximized = !maximized">Maximize</span>\n            <span id="config-bar-hide" ng-click="opened = !opened">Close</span>\n        </div>\n        <ul id="config-bar-content">\n            <li>\n                <span ng-click="addToOverride(propertyToOverride)" class="add-to-override">+</span>\n                <input type="text" ng-model="propertyToOverride" id="config-bar-property-name" placeholder="Property Name" />\n            </li>\n            <li>\n                <span ng-click="removeOverridden(\'user\'); overridden.user = null;" class="reset">X</span>\n                <input type="number" ng-model="overridden.user" placeholder="User" ng-change="override(\'user\', overridden.user)" />\n            </li>\n            <li style="display: none">\n                <span ng-click="removeOverridden(\'time\'); overridden.time= null;" class="reset">X</span>\n                <input type="text" ng-model="overridden.time" placeholder="Time" ng-change="override(\'time\', overridden.time)" />\n                <i>{{date | date:\'yyyy-MM-dd_HH:mm:ss\'}}</i>\n            </li>\n            <li ng-repeat="(name, value) in getOverridden() track by name">\n                <span class="reset" ng-click="removeOverridden(name)">X</span>\n                <input type="text" disabled class="property-name" ng-model="name" />\n                <input type="text" class="property-value" placeholder="Value" ng-model="value" ng-change="override(name, value)" />\n            </li>\n            <div class=\'section\' ng-click="openABTesting()">AB Testing <span id="abExperimentName">{{abExperiment.identifier }}</span></div>\n            <ul id="config-bar-ab" ng-cloak ng-show="abTestingOpened">\n                <li>\n                    <ul id="abSetupInfo">\n                        <li ng-repeat="setup in abExperiment.setups">\n                            <strong class="setup-id">#{{ setup.id }}</strong>\n                            <ul>\n                                <li ng-repeat="value in setup.values">\n                                    <span class="variable-name" title="{{ value.variable.app_name }}.{{ value.variable.name }} ">\n                                        {{ value.variable.name.split(\'.\').slice(-1)[0] | limitTo: 12 }}{{ value.variable.name.split(\'.\').slice(-1)[0].length > 12 ? \'...\' : \'\' }}\n                                    </span>\n                                    <span class="variable-value" title="{{ value.value }}">{{ value.value.split(\'.\').slice(-1)[0] | limitTo: 12 }} {{ value.value.split(\'.\').slice(-1)[0].length > 12 ? \'...\' : \'\' }}</span>\n                                    <span class="comma" ng-if="!$last">,</a>\n                                </li>\n                            </ul>\n                        </li>\n                    </ul>\n                <li>\n                <div id="abChart"></div>\n                <li>\n                    <button ng-click="drawABTestingBar()" class="ab-experiment-chart-button">All</button>\n                    <button ng-click="drawABTestingBar(\'number_of_users\')" class="ab-experiment-chart-button">Users</button>\n                    <button ng-click="drawABTestingBar(\'number_of_answers\')" class="ab-experiment-chart-button">Answers</button>\n                    <button ng-click="drawABTestingBar(\'returning_chance\')" class="ab-experiment-chart-button">Return</button>\n                    <button ng-click="drawABTestingLearning(false)" class="ab-experiment-chart-button" title="Learning curve containing only users with at least the given number of testing answers">Learn</button>\n                    <button ng-click="drawABTestingLearning(true)" class="ab-experiment-chart-button" title="Learning curve containing all users with at least one testing answer">Learn (A)</button>\n                </li>\n            </ul>\n            <div class=\'section\' ng-click="flashcardsOpened = !flashcardsOpened">Flashcards</div>\n            <ul id="config-bar-flashcards" ng-cloak ng-show="flashcardsOpened">\n                <li>\n                    <input type="text" ng-model="flashcardsCategories" placeholder="Categories" />\n                    <input type="text" ng-model="flashcardsContexts" placeholder="Contexts" />\n                    <input type="text" ng-model="flashcardsTypes" placeholder="Types" />\n                </li>\n                <li>\n                    <input type="text" ng-model="flashcardsLimit" placeholder="Limit" />\n                    <button ng-click="showFlashcardsPractice()">Show Practice</button>\n                    <button ng-click="showFlashcardsAnswers()">Show Answers</button>\n                </li>\n                <div style="overflow: auto; width: 100%; height: 300px;">\n                    <table ng-show="flashcardsAnswers.length > 0" id="flashcardsAnswers">\n                        <thead>\n                            <tr>\n                                <th>#</th>\n                                <th>User</th>\n                                <th>Item</th>\n                                <th>Asked</th>\n                                <th>Answered</th>\n                                <th>Opt.</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            <tr ng-repeat="answer in flashcardsAnswers">\n                                <td>\n                                    <a href="/flashcards/answer/{{ answer.id }}?html" title="{{answer.time | date:\'yyyy-MM-dd_HH:mm:ss\'}}, direction: {{ answer.direction }}">\n                                        {{ answer.id }}\n                                    </a>\n                                </td>\n                                <td>{{ answer.user_id }}</td>\n                                <td>{{ answer.item_asked_id }}</td>\n                                <td>{{ answer.flashcard_asked.identifier | limitTo:12 }} {{ answer.flashcard_answered.identifier.length > 12 ? \'...\' : \'\' }}</td>\n                                <td ng-class="{true: \'correct\', false: \'wrong\'}[answer.item_asked_id == answer.item_answered_id]">\n                                    {{ answer.flashcard_answered.identifier | limitTo:12 }}{{ answer.flashcard_answered.identifier.length > 12 ? \'...\' : \'\' }}\n                                </td>\n                                <td class="direction-{{ answer.direction }}">{{ answer.options.length }}</td>\n                            </tr>\n                        </tbody>\n                    </table>\n                    <div id="flashcardsChart"></div>\n                </div>\n            </ul>\n            <div class=\'section\' ng-click="auditOpened = !auditOpened">Models Audit</div>\n            <ul id="config-bar-audit" ng-cloak ng-show="auditOpened">\n                <li>\n                    <input type="text" ng-model="auditLimit" placeholder="Limit" />\n                    <input type="text" ng-model="auditKey" placeholder="Key" id="config-bar-audit-key" />\n                    <input type="text" ng-model="auditUser" placeholder="User" />\n                </li>\n                <li>\n                    <input type="text" ng-model="auditPrimary" placeholder="Item Primary" />\n                    <input type="text" ng-model="auditSecondary" placeholder="Item Secondary" />\n                    <button ng-click="showAuditChart()">Show Chart</button>\n                </li>\n                <div id="auditChart"></div>\n            </ul>\n            <div class=\'section\' ng-click="recommendationOpened = !recommendationOpened">Recommend User</div>\n            <ul id="config-bar-recommendation" ng-cloak ng-show="recommendationOpened">\n                <li>\n                    <input type="text" placeholder="Register Time" disabled/>\n                    <input type="text" placeholder="Min" ng-model="recommendationRegisterMin" />\n                    <input type="text" placeholder="Max" ng-model="recommendationRegisterMax" />\n                </li>\n                <li>\n                    <input type="text" placeholder="Number of Answers" disabled/>\n                    <input type="text" placeholder="Min" ng-model="recommendationAnswersMin" />\n                    <input type="text" placeholder="Max" ng-model="recommendationAnswersMax" />\n                </li>\n                <li>\n                    <input type="text" placeholder="Success" disabled/>\n                    <input type="text" placeholder="Min" ng-model="recommendationSuccessMin" />\n                    <input type="text" placeholder="Max" ng-model="recommendationSuccessMax" />\n                </li>\n                <li>\n                    <input type="text" placeholder="Variable Name" ng-model="recommendationVariableName" />\n                    <input type="text" placeholder="Min" ng-model="recommendationVariableMin" />\n                    <input type="text" placeholder="Max" ng-model="recommendationVariableMax" />\n                </li>\n                <li>\n                    <input type="text" ng-model="recommendationOutput" disabled />\n                    <button ng-click="recommendUser()">Recommend</button>\n                </li>\n            </ul>\n            <div class=\'section\' ng-click="loggingOpened = !loggingOpened">Logging</div>\n            <ul id="config-bar-logging" ng-cloak ng-show="loggingOpened">\n                <li ng-repeat="event in debugLog|limitTo:100" class="logging-event">\n                    <span class="level">{{ event.level }}</span>\n                    <span class="url">{{ event.url }}</span>\n                    <span class="filename">{{ event.filename }}:{{ event.line_number }}</span>\n                    <span class="message">{{ event.message }}</span>\n                </li>\n            </ul>\n        </ul>\n    </div>\n</div>\n');
}]),angular.module("templates/feedback-comment/comment.html",[]).run(["$templateCache",function(a){a.put("templates/feedback-comment/comment.html",'<div class="modal-header">\n    <h3 class="modal-title">{{ "Write to us" | translate }}</h3>\n</div>\n<div class="modal-body">\n    <label>\n      {{ "Did you find a bug in the app? Do you have an improvement idea? Or any other comment? We are eager to hear anything you\'d like to tell us." | translate }}\n    </label>\n    <textarea ng-model="feedback.text" class="form-control" rows="8" ></textarea>\n    <label>\n      {{ "Your e-mail address (optional)" | translate }}\n    </label>\n    <input type="text" ng-model="feedback.email" class="form-control"/>\n    <br>\n    <alert ng-repeat="alert in alerts" type="{{alert.type}}" close="closeAlert($index)">{{alert.msg}}</alert>\n</div>\n<div class="modal-footer">\n    <button ng-disabled="sending" class="btn btn-primary" ng-click="send()">\n      {{ "Send" | translate }}\n    </button>\n    <button class="btn btn-danger" ng-click="cancel()">\n      {{ "Close" | translate }}\n    </button>\n</div>\n\n')}]),angular.module("templates/feedback-rating/rating.html",[]).run(["$templateCache",function(a){a.put("templates/feedback-rating/rating.html",'<div class="modal-header text-center">\n    <h3 class="modal-title">{{ "How difficult are the questions?" | translate }}</h3>\n    {{ "Your answer helps us adjust difficulty of questions." | translate }}\n</div>\n<div class="rating modal-body">\n    <div class=" text-center" ng-hide="answer">\n        <a class="btn btn-lg btn-success" ng-click="vote(1)">\n            {{"Too easy" | translate }}\n        </a>\n        <a class="btn btn-lg btn-primary" ng-click="vote(2)">\n            {{ "Appropriate" | translate }}\n        </a>\n        <a class="btn btn-lg btn-danger" ng-click="vote(3)">\n            {{ "Too difficult" | translate }}\n        </a>\n        <div class="clearfix"></div>\n        <a class="pull-right dont-know" href="" ng-click="cancel()">\n            {{ "Don\'t know / Don\'t want to rate" | translate }}\n        </a>\n        <div class="clearfix"></div>\n    </div>\n    <alert ng-repeat="alert in alerts" type="{{alert.type}}" close="closeAlert($index)">{{alert.msg}}</alert>\n</div>\n<div class="modal-footer" ng-show="answer">\n    <button class="btn btn-danger" ng-click="cancel()">\n        {{ "Close" | translate }}\n    </button>\n</div>\n\n')}]),angular.module("templates/user-login/login-modal.html",[]).run(["$templateCache",function(a){a.put("templates/user-login/login-modal.html",'<div class="modal-header text-center">\n    <button type="button" class="close" ng-click="cancel()">\n        <span aria-hidden="true">&times;</span>\n    </button>\n    <h3 class="modal-title"> {{ "Sign In" | translate }} </h3>\n</div>\n<div class="modal-body">\n    <a class="btn btn-danger btn-lg btn-block"\n        track-click="login"\n        href="/login/google-oauth2/">\n        <i class="social-google"></i> {{ "via Google" | translate }}\n    </a>\n    <br>\n    <a class="btn btn-primary btn-lg btn-block"\n        track-click="login"\n        href="/login/facebook/">\n        <i class="social-facebook"></i>{{ "via Facebook" | translate }}\n    </a>\n\n    <br>\n    <hr>\n    <br>\n\n    <form role="form" ng-submit="loginEmail()">\n        <div class="form-group">\n            <input type="text" class="form-control" ng-model="credentials.username"\n            name="username" placeholder="{{ \'Username\' | translate }}">\n        </div>\n        <div class="form-group">\n            <input type="password" class="form-control" ng-model="credentials.password"\n            name="password" placeholder="{{ \'Password\' | translate }}">\n        </div>\n        <alert ng-repeat="alert in alerts" type="{{alert.type}}"\n            close="closeAlert($index)">{{alert.msg}}</alert>\n        <button ng-disabled="userService.status.loading" type="submit"\n            class="btn btn-primary btn-block btn-lg">\n            {{ \'Sign In\' | translate }}\n        </button>\n\n    </form>\n</div>\n<div class="modal-footer" >\n        <a class="btn btn-link" ng-click="openSignupModal()">\n            {{ \'Sign Up\' | translate }}\n        </a>\n\n</div>\n')}]),angular.module("templates/user-login/signup-modal.html",[]).run(["$templateCache",function(a){a.put("templates/user-login/signup-modal.html",'<div class="modal-header text-center">\n    <button type="button" class="close" ng-click="cancel()">\n        <span aria-hidden="true">&times;</span>\n    </button>\n    <h3 class="modal-title"> {{ "Sign Up" | translate }} </h3>\n    <div ng-hide="success">\n        {{" and get all the benefits of registered users." | translate }}\n    </div>\n</div>\n<div class="modal-body" ng-hide="success">\n    <div ng-hide="activateEmail">\n        <a class="btn btn-danger btn-lg btn-block"\n            track-click="login"\n            href="/login/google-oauth2/">\n            <i class="social-google"></i> {{ "via Google" | translate }}\n        </a>\n        <br>\n        <a class="btn btn-primary btn-lg btn-block"\n            track-click="login"\n            href="/login/facebook/">\n            <i class="social-facebook"></i>{{ "via Facebook" | translate }}\n        </a>\n        <br>\n        <a class="btn btn-info btn-lg btn-block"\n            ng-click="activateEmail=true"\n            href="">\n            <i class="glyphicon glyphicon-envelope"></i> {{ "via E-mail" | translate }}\n        </a>\n    </div>\n\n    <form role="form" ng-show="activateEmail" ng-submit="signup()">\n        <div class="form-group">\n            <input type="email" class="form-control" ng-model="credentials.email"\n                placeholder="{{ \'E-mail\' | translate }}" required>\n        </div>\n        <div class="form-group">\n            <input type="text" class="form-control" ng-model="credentials.username"\n                name="username" placeholder="{{ \'Username\' | translate }}" required>\n        </div>\n        <div class="form-group">\n            <input type="password" class="form-control" ng-model="credentials.password"\n                name="password" placeholder="{{ \'Password\' | translate }}" required>\n        </div>\n        <div class="form-group">\n            <input type="password" class="form-control"\n                ng-model="credentials.password_check"\n                placeholder="{{ \'Password again\' | translate }}" required>\n        </div>\n        <alert ng-repeat="alert in alerts" type="{{alert.type}}"\n            close="closeAlert($index)">{{alert.msg}}</alert>\n        <button ng-disabled="userService.status.loading" type="submit" class="btn btn-primary btn-block btn-lg">\n            {{ \'Sign Up\' | translate }}\n        </button>\n    </form>\n</div>\n<div class="modal-body" ng-show="success" >\n        <alert type="success">\n            {{ \'Registration was successful. You can continue to use the application.\' | translate }}\n        </alert>\n</div>\n\n')}]),!angular.$$csp()&&angular.element(document).find("head").prepend('<style type="text/css">#config-bar-show-button{position:fixed;right:-40px;top:250px;width:100px;transform:rotate(-90deg);-webkit-transform:rotate(-90deg);border:solid #808080 1px;margin:0;padding:10px;text-transform:capitalize;font-weight:bold;background-color:rgba(255,255,255,0.8);transition:all 0.2s;cursor:pointer;text-align:center;z-index:1000;}#config-bar-show-button:hover{background-color:#1f8dd6;color:white;}#config-bar{position:fixed;right:0;top:0;bottom:0;width:500px;border-left:solid #808080 1px;background-color:rgba(255,255,255,0.8);z-index:1000;}#config-bar.maximized{width:100%;}#config-bar-header{background-color:rgba(31,141,214,0.8);margin:0;padding:5px 10px;text-align:right;color:white;}#config-bar-content .section{background-color:rgba(31,141,214,0.8);margin:5px 0;padding:5px 10px;color:white;text-transform:uppercase;cursor:pointer;}#config-bar-maximize{text-align:right;cursor:pointer;margin-right:20px;}#config-bar-hide{text-align:right;width:100%;cursor:pointer;}#config-bar-content{margin:0;list-style:none;padding:0;}#config-bar-content > li{border-bottom:1px dashed #E9F4FB;padding:5px 10px;margin:0;}#config-bar-content > li:hover{background:#E9F4FB;}#config-bar-content .reset,#config-bar-content .add-to-override{cursor:pointer;font-weight:bolder;}#config-bar-content input{padding:5px 10px;}#config-bar-content label{margin-left:10px;cursor:pointer;}#config-bar-content .link{text-transform:uppercase;cursor:pointer;font-weight:bold;}#config-bar-logging{list-style:none;margin:0;padding:0;max-height:500px;overflow-y:scroll;font-size:12px;}#config-bar-logging > li{margin:0;padding:5px 10px;border-bottom:1px solid #E9F4FB;}#config-bar-logging > li:hover{background-color:#E9F4FB;}#config-bar-logging .level{display:block;float:left;width:10%;font-weight:bold;}#config-bar-logging .url{font-weight:bold;margin-left:10px;display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;width:50%;float:left;}#config-bar-logging .filename{display:block;float:right;text-align:right;width:30%;font-weight:bold;}#config-bar-logging .message{display:block;clear:both;margin-top:20px;margin-bottom:5px;}#config-bar-content .property-name{width:70%;}#config-bar-content .property-value{width:10%;text-align:center;}#config-bar-property-name{width:70%;}#config-bar-audit,#config-bar-ab,#config-bar-flashcards,#config-bar-recommendation{padding-left:5px;}#config-bar-audit li,#config-bar-ab li,#config-bar-flashcards li,#config-bar-recommendation li{padding-left:0;margin-left:0;list-style:none;margin-bottom:5px;}#config-bar-ab ul{padding-left:0;margin-left:0;}.ab-experiment-chart-button{font-size:13px;width:15%;}#config-bar-audit input,#config-bar-flashcards input,#config-bar-recommendation input{width:27%;}#config-bar-audit button,#config-bar-flashcards button,#config-bar-recommendation button{width:27%;}#auditChart{margin:10px auto;width:480px;}#abChart{margin:0 auto;width:480px;}#flashcardsChart{margin:0 auto;width:100%;height:1000px;}#abExperimentName{margin-left:20px;font-weight:bold;}#abSetupInfo > li > ul,#abSetupInfo > li > ul > li{display:inline;}#flashcardsAnswers{width:100%;}#flashcardsAnswers thead{color:#fff;background-color:rgba(31,141,214,0.8);}#flashcardsAnswers th,#flashcardsAnswers td{text-align:center;}#flashcardsAnswers tbody tr:nth-child(even){background-color:#E9F4FB;}#flashcardsAnswers tbody tr:nth-child(odd){background-color:#fff;}#flashcardsAnswers td.correct{background-color:#009933;color:white;}#flashcardsAnswers td.wrong{background-color:#cc0000;color:white;}#flashcardsAnswers td.direction-t2d{background-color:#ff9900;color:white;}#flashcardsAnswers td.direction-d2t{background-color:#ffff00;}</style>'),!angular.$$csp()&&angular.element(document).find("head").prepend('<style type="text/css">.rating .btn{margin:20px;}</style>');
//# sourceMappingURL=proso-apps-all.min.js.map